<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Mybatis示例 | ALifeBug</title><meta name="description" content="Mybatis示例"><meta name="keywords" content="Mybatis"><meta name="author" content="Huang Qingshan"><meta name="copyright" content="Huang Qingshan"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://alifebug.github.io/2021/02/16/Mybatis%E7%A4%BA%E4%BE%8B/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Mybatis示例"><meta name="twitter:description" content="Mybatis示例"><meta name="twitter:image" content="https://s2.ax1x.com/2019/11/04/Kv8O6U.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Mybatis示例"><meta property="og:url" content="http://alifebug.github.io/2021/02/16/Mybatis%E7%A4%BA%E4%BE%8B/"><meta property="og:site_name" content="ALifeBug"><meta property="og:description" content="Mybatis示例"><meta property="og:image" content="https://s2.ax1x.com/2019/11/04/Kv8O6U.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="SpringCloud全系列笔记" href="http://alifebug.github.io/2021/02/17/SpringCloud%E5%85%A8%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0/"><link rel="next" title="Leetcode-SQL" href="http://alifebug.github.io/2020/12/20/Leetcode-SQL/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="header"> <div id="page-header"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">ALifeBug</a></span><i class="fa fa-bars fa-fw toggle-menu pull-right close" aria-hidden="true"></i><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lozad avatar_img" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/Photo/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">15</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">16</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Mybatis示例"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Mybatis示例</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Pom"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">Pom</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#启动类"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">启动类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#tables"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">tables</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Yaml"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">Yaml</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#domain"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">domain</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Mapper"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">Mapper</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Test"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">Test</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mybatis示例"><span class="toc-number">1.</span> <span class="toc-text">Mybatis示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pom"><span class="toc-number">1.1.</span> <span class="toc-text">Pom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动类"><span class="toc-number">1.2.</span> <span class="toc-text">启动类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tables"><span class="toc-number">1.3.</span> <span class="toc-text">tables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yaml"><span class="toc-number">1.4.</span> <span class="toc-text">Yaml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#domain"><span class="toc-number">1.5.</span> <span class="toc-text">domain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapper"><span class="toc-number">1.6.</span> <span class="toc-text">Mapper</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test"><span class="toc-number">1.7.</span> <span class="toc-text">Test</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://s2.ax1x.com/2019/11/04/Kv8O6U.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Mybatis示例</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-02-16<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-02-17</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Mybatis/">Mybatis</a></span><div class="post-meta-wordcount"><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h1 id="Mybatis示例"><a href="#Mybatis示例" class="headerlink" title="Mybatis示例"></a>Mybatis示例</h1><h2 id="Pom"><a href="#Pom" class="headerlink" title="Pom"></a>Pom</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>org.mybatis.spring.boot<span class="tag"></<span class="name">groupId</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>mybatis-spring-boot-starter<span class="tag"></<span class="name">artifactId</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">version</span>></span>2.1.4<span class="tag"></<span class="name">version</span>></span></span><br><span class="line"><span class="tag"></<span class="name">dependency</span>></span></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>mysql<span class="tag"></<span class="name">groupId</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>mysql-connector-java<span class="tag"></<span class="name">artifactId</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">scope</span>></span>runtime<span class="tag"></<span class="name">scope</span>></span></span><br><span class="line"><span class="tag"></<span class="name">dependency</span>></span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.huang.cloud.userservice.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(UserServiceApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="tables"><a href="#tables" class="headerlink" title="tables"></a>tables</h2><p><a href="https://imgchr.com/i/ygepI1" target="_blank" rel="noopener"><img alt="ygepI1.png" data-src="https://s3.ax1x.com/2021/02/16/ygepI1.png" class="lozad"></a></p>
<h2 id="Yaml"><a href="#Yaml" class="headerlink" title="Yaml"></a>Yaml</h2><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&characterEncoding=utf8&allowMultiQueries=true&serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">858937</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.huang.cloud.userservice.domain</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com:</span></span><br><span class="line">      <span class="attr">huang:</span></span><br><span class="line">        <span class="attr">cloud:</span></span><br><span class="line">          <span class="attr">userservice:</span></span><br><span class="line">            <span class="attr">mapper:</span> <span class="string">debug</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="domain"><a href="#domain" class="headerlink" title="domain"></a>domain</h2><p>SysUser.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">用户表 实体类中不要有基本类型，因为基本类型会有默认值就不能做判空</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUser</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userPassword;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userEmail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    简介</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] headImg; <span class="comment">//对应blob</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    用户角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List<SysRole> roleList;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setter,getter...</span></span><br></pre></td></tr></tbody></table></figure>

<p>SysRole.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">角色表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysRole</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line">    <span class="keyword">private</span> Integer enabled;</span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> SysUser user;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>SysPrivilege.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysPrivilege</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String privilegeName;</span><br><span class="line">    <span class="keyword">private</span> String privilegeUrl;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><p>UserMapper</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function">SysUser <span class="title">selectById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysUser> <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysRole> <span class="title">selectRolesByUserId</span><span class="params">(Long userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(SysUser user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert2</span><span class="params">(SysUser user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert3</span><span class="params">(SysUser user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateById</span><span class="params">(SysUser user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//多个参数需要用@Param指定，如果参数类型是多个JavaBean如:@Param("user")SysUser user,@Param("role")SysRole role则</span></span><br><span class="line">    <span class="comment">//不能直接使用#{userId}和#{enabled},而是#{user.id},#{role.enabled}</span></span><br><span class="line">    <span class="function">List<SysRole> <span class="title">selectRolesByUserIdAndRoleEnabled</span><span class="params">(@Param(<span class="string">"userId"</span>)</span>Long userId,@<span class="title">Param</span><span class="params">(<span class="string">"enabled"</span>)</span>Integer enabled)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysUser> <span class="title">selectByUser</span><span class="params">(SysUser user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByIdSelective</span><span class="params">(SysUser user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">SysUser <span class="title">selectByIdOrUserName</span><span class="params">(SysUser user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysUser> <span class="title">selectByIdList</span><span class="params">(List<Long> idList)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertList</span><span class="params">(List<SysUser> userList)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByMap</span><span class="params">(Map<String,Object> map)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">SysUser <span class="title">selectUserAndRoleById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">SysUser <span class="title">selectUserAndRoleById2</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">SysUser <span class="title">selectUserAndRoleByIdSelect</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysUser> <span class="title">selectAllUserAndRoles</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">SysUser <span class="title">selectAllUserAndRolesSelect</span><span class="params">(Long id)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><?xml version="1.0" encoding="utf-8" ?></span></span><br><span class="line"><span class="meta"><!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> ></span></span><br><span class="line"><span class="tag"><<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.huang.cloud.userservice.mapper.UserMapper"</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">cache</span>/></span>开启二级缓存,和命名空间绑定</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span> id,type是必填的,extends选填</span><br><span class="line">        <span class="tag"><<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"user_info"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userEmail"</span> <span class="attr">column</span>=<span class="string">"user_email"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"headImg"</span> <span class="attr">column</span>=<span class="string">"head_img"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    resultMap中如果映射到一个JavaBean，通常可以自动判断属性类型，如果映射到HashMap，则需要明确指定javaType属性</span><br><span class="line">    property属性或别名需要和对象的属性名字相同，但是实际匹配时，Mybatis会先将两者都转换成大写形式，再判断是否相同</span><br><span class="line">        即property=userName,username都可以匹配到userName属性上</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"user_info"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userEmail"</span> <span class="attr">column</span>=<span class="string">"user_email"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"headImg"</span> <span class="attr">column</span>=<span class="string">"head_img"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/></span></span><br><span class="line">        <span class="symbol">&lt;</span>!<span class="symbol">&ndash;</span>role相关属性<span class="symbol">&ndash;</span><span class="symbol">&gt;</span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.id"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.enabled"</span> <span class="attr">column</span>=<span class="string">"enabled"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createTime"</span> <span class="attr">column</span>=<span class="string">"role_create_time"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    role的property配置部分使用role.前缀，在column部分，为了避免不同表中存在相同的列，所有可能重名的列都增加了role_前缀</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.id"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.enabled"</span> <span class="attr">column</span>=<span class="string">"enabled"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role.createTime"</span> <span class="attr">column</span>=<span class="string">"role_create_time"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    使用extends继承</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">columnPrefix</span>=<span class="string">"role_"</span> <span class="attr">javaType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"enabled"</span> <span class="attr">column</span>=<span class="string">"enabled"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/></span></span><br><span class="line">        <span class="tag"></<span class="name">association</span>></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    使用assciation指定了前缀role_,则查询出来的列别名都需要加上role_前缀，变成role_id,role_role_name,role_enabled</span><br><span class="line">        role_create_by,role_create_time</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">columnPrefix</span>=<span class="string">"role_"</span> <span class="attr">resultMap</span>=<span class="string">"com.huang.cloud.userservice.mapper.RoleMapper.roleMap"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    使用association直接指定resultMap</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMapSelect"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">column</span>=<span class="string">"{id=role_id}"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">select</span>=<span class="string">"com.huang.cloud.userservice.mapper.UserMapper.selectRoleById"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> <span class="attr">column</span>=<span class="string">"user_password"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userEmail"</span> <span class="attr">column</span>=<span class="string">"user_email"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"user_info"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"headImg"</span> <span class="attr">column</span>=<span class="string">"head_img"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span> <span class="attr">columnPrefix</span>=<span class="string">"role_"</span> <span class="attr">javaType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"enabled"</span> <span class="attr">column</span>=<span class="string">"enabled"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/></span></span><br><span class="line">        <span class="tag"></<span class="name">collection</span>></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    只是把association改成了collection,将property改成了roleList,</span><br><span class="line">    同时能存储一对多的数据结构肯定也能存储一对一关系，所以一对一像是一对多的特例</span><br><span class="line">    在做嵌套查询的时候，mybatis会递归的将相同id的数据合并到一起，如果没有id这个标签</span><br><span class="line">    就会逐个字段进行比较，效率降低</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span> <span class="attr">columnPrefix</span>=<span class="string">"role_"</span> <span class="attr">resultMap</span>=<span class="string">"com.huang.cloud.userservice.mapper.RoleMapper.roleMap"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    同样可以简化成这样</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span> <span class="attr">columnPrefix</span>=<span class="string">"role_"</span> <span class="attr">resultMap</span>=<span class="string">"com.huang.cloud.userservice.mapper.RoleMapper.rolePrivilegesMap"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleListMapSelect"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span> <span class="attr">extends</span>=<span class="string">"BaseResultMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">fetchType</span>=<span class="string">"lazy"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">"com.huang.cloud.userservice.mapper.RoleMapper.selectRoleByUserId"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">column</span>=<span class="string">"{userId=id}"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectById"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>></span>返回值必须和resultMap中的type一致</span><br><span class="line">    select * from sys_user where id = #{id}</span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAll"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span>该sql可能返回多个结果，所以需要用List接收</span><br><span class="line">    select id,</span><br><span class="line">           user_name userName,</span><br><span class="line">           user_info userInfo,</span><br><span class="line">           user_email userEmail,</span><br><span class="line">           user_password userPassword,</span><br><span class="line">           head_img headImg,</span><br><span class="line">           create_time createTime</span><br><span class="line">    from sys_user</span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line">使用resultType设置返回结果类型时，需要在SQL重设置别名，并与指定对象的属性名保持一致，实现自动映射</span><br><span class="line">如果开启了mapUnderscoreToCamelCase即可以自动转换(默认为false)，就不需要设置别名了</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRolesByUserId"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span>></span></span><br><span class="line">    select</span><br><span class="line">        r.id,</span><br><span class="line">        r.role_name roleName,</span><br><span class="line">        r.create_by createBy,</span><br><span class="line">        r.create_time createTime,</span><br><span class="line">        r.enabled,</span><br><span class="line">        u.user_name as "user.userName",</span><br><span class="line">        u.user_email as "user.userEmail"</span><br><span class="line">    from sys_user u</span><br><span class="line">        inner join sys_user_role ur on u.id = ur.user_id</span><br><span class="line">        inner join sys_role r on ur.role_id = r.id</span><br><span class="line">    where u.id = #{userId}</span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line">添加user属性的别名需要用user.属性名</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span>></span></span><br><span class="line">    insert into sys_user(id, user_name, user_password, user_email, user_info, head_img, create_time) VALUES</span><br><span class="line">    (</span><br><span class="line">      #{id},#{userName},#{userPassword},#{userEmail},#{userInfo},#{headImg,jdbcType=BLOB},#{createTime,jdbcType=TIMESTAMP}</span><br><span class="line">    )</span><br><span class="line"><span class="tag"></<span class="name">insert</span>></span></span><br><span class="line">为了防止类型错误指定Jdbctype</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert2"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>></span></span><br><span class="line">    insert into sys_user(id, user_name, user_password,</span><br><span class="line">     <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userEmail != null and userEmail != ''"</span>></span></span><br><span class="line">         user_email = #{userEmail},</span><br><span class="line">     <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">     user_info, head_img, create_time) VALUES</span><br><span class="line">    (</span><br><span class="line">        #{id},#{userName},#{userPassword},</span><br><span class="line">     <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userEmail != null and userEmail != ''"</span>></span></span><br><span class="line">        #{userEmail},</span><br><span class="line">     <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">     #{userInfo},#{headImg,jdbcType=BLOB},#{createTime,jdbcType=TIMESTAMP}</span><br><span class="line">    )</span><br><span class="line"><span class="tag"></<span class="name">insert</span>></span></span><br><span class="line">useGeneratedKeys设置为true后，Mybatis会用JDBC的getGeneratedKeys方法取出数据库内部生成的主键，然后赋值keyPropeyty的id属性</span><br><span class="line">    这种方式只适合主键自增的库</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert3"</span>></span></span><br><span class="line">    insert into sys_user(id, user_name, user_password, user_email, user_info, head_img, create_time) VALUES</span><br><span class="line">    (</span><br><span class="line">        #{id},#{userName},#{userPassword},#{userEmail},#{userInfo},#{headImg,jdbcType=BLOB},#{createTime,jdbcType=TIMESTAMP}</span><br><span class="line">    )</span><br><span class="line">    <span class="tag"><<span class="name">selectKey</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"long"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>></span></span><br><span class="line">        select LAST_INSERT_ID()</span><br><span class="line">    <span class="tag"></<span class="name">selectKey</span>></span></span><br><span class="line"><span class="tag"></<span class="name">insert</span>></span></span><br><span class="line">mysql数据库中order属性设置为AFTER因为当前记录的主键值在insert语句执行成功后才能获取到，oracle数据库中设置为BEFORE</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateById"</span>></span></span><br><span class="line">    update sys_user</span><br><span class="line">    set user_name = #{userName},</span><br><span class="line">        user_password = #{userPassword},</span><br><span class="line">        user_email = #{userEmail},</span><br><span class="line">        user_info = #{userInfo},</span><br><span class="line">        head_img = #{headImg,jdbcType=BLOB},</span><br><span class="line">        create_time = #{createTime,jdbcType=TIMESTAMP}</span><br><span class="line">    where id = #{id}</span><br><span class="line"><span class="tag"></<span class="name">update</span>></span></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteById"</span>></span></span><br><span class="line">    delete from sys_user where id = #{id}</span><br><span class="line"><span class="tag"></<span class="name">delete</span>></span></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRolesByUserIdAndRoleEnabled"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span>></span></span><br><span class="line">    select</span><br><span class="line">        r.id,</span><br><span class="line">        r.role_name roleName,</span><br><span class="line">        r.create_by createBy,</span><br><span class="line">        r.create_time createTime,</span><br><span class="line">        r.enabled,</span><br><span class="line">        u.user_name as "user.userName",</span><br><span class="line">        u.user_email as "user.userEmail"</span><br><span class="line">    from sys_user u</span><br><span class="line">    inner join sys_user_role ur on u.id = ur.user_id</span><br><span class="line">    inner join sys_role r on r.id = ur.role_id</span><br><span class="line">    where u.id = #{userId} and r.enabled = #{enabled}</span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByUser"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">    select</span><br><span class="line">        id,</span><br><span class="line">        user_name userName,</span><br><span class="line">        user_password userPassword,</span><br><span class="line">        user_email userEmail,</span><br><span class="line">        user_info userInfo,</span><br><span class="line">        head_img headImg,</span><br><span class="line">        create_time createTime</span><br><span class="line">    from sys_user</span><br><span class="line">    where 1=1</span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != null and userName != ''"</span>></span></span><br><span class="line">        and user_name like concat("%",#{userName},"%")</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userEmail != null and userEmail != ''"</span>></span></span><br><span class="line">        and user_email = #{userEmail}</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line">加上1=1防止sql错误</span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByUser"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">    select</span><br><span class="line">    id,</span><br><span class="line">    user_name userName,</span><br><span class="line">    user_password userPassword,</span><br><span class="line">    user_email userEmail,</span><br><span class="line">    user_info userInfo,</span><br><span class="line">    head_img headImg,</span><br><span class="line">    create_time createTime</span><br><span class="line">    from sys_user</span><br><span class="line">    <span class="tag"><<span class="name">where</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName !=null and userName !=''"</span>></span></span><br><span class="line">            and user_name like concat("%",#{userName},"%")</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName !=null and userName !=''"</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"userNameLike"</span> <span class="attr">value</span>=<span class="string">"'%'+userName+'%'"</span>/></span></span><br><span class="line">            and user_name like #{userNameLike}</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userEmail !=null and userEmail !=''"</span>></span></span><br><span class="line">            and user_email = #{userEmail}</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    <span class="tag"></<span class="name">where</span>></span></span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line">当if条件都不满足时，where元素中没有内容，if条件满足时，where会去掉开头的and</span><br><span class="line">where标签相当于:</span><br><span class="line">    <span class="tag"><<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"where"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND |OR "</span>></span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag"></<span class="name">trim</span>></span></span><br><span class="line">    意思是如果trim元素中包含内容，会给内容增加prefix指定的前缀，并且会吧内容中的prefixOverrides指定的前缀字符串去掉</span><br><span class="line"></span><br><span class="line">bind标签创建变量</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateByIdSelective"</span>></span></span><br><span class="line">    update sys_user set</span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != null and userName != ''"</span>></span></span><br><span class="line">        user_name = #{userName},</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userPassword != null and userPassword != ''"</span>></span></span><br><span class="line">        user_password = #{userPassword},</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userEmail != null and userEmail !='' "</span>></span></span><br><span class="line">        user_email = #{userEmail},</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userInfo != null"</span>></span></span><br><span class="line">        user_info= #{userInfo},</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"headImg != null"</span>></span></span><br><span class="line">        head_img = #{headImg},</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"createTime != null"</span>></span></span><br><span class="line">        create_time = #{createTime},</span><br><span class="line">    <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">    id = #{id}</span><br><span class="line">    where id = #{id}</span><br><span class="line"><span class="tag"></<span class="name">update</span>></span></span><br><span class="line">id=#{id}防止sql错误</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateByIdSelective"</span>></span></span><br><span class="line">    update sys_user</span><br><span class="line">    <span class="tag"><<span class="name">set</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != null and userName != ''"</span>></span></span><br><span class="line">            user_name = #{userName},</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userPassword != null and userPassword != ''"</span>></span></span><br><span class="line">            user_password = #{userPassword},</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userEmail != null and userEmail !='' "</span>></span></span><br><span class="line">            user_email = #{userEmail},</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userInfo != null"</span>></span></span><br><span class="line">            user_info= #{userInfo},</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"headImg != null"</span>></span></span><br><span class="line">            head_img = #{headImg},</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"createTime != null"</span>></span></span><br><span class="line">            create_time = #{createTime},</span><br><span class="line">        <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">        id = #{id},</span><br><span class="line">    <span class="tag"></<span class="name">set</span>></span></span><br><span class="line">    where id = #{id}</span><br><span class="line"><span class="tag"></<span class="name">update</span>></span></span><br><span class="line">set元素中的,没有问题，但是还是要加上id=#{id}防止出现空白</span><br><span class="line">where标签相当于:</span><br><span class="line">    <span class="tag"><<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"set"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>></span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag"></<span class="name">trim</span>></span></span><br><span class="line">    意思是如果trim元素中包含内容，会给内容增加prefix指定的前缀，并且会把内容中的suffixOverrides指定的后缀字符串去掉</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByIdOrUserName"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">    select id,</span><br><span class="line">           user_name userName,</span><br><span class="line">           user_password userPassword,</span><br><span class="line">           user_email userEmail,</span><br><span class="line">           user_info userInfo,</span><br><span class="line">           head_img headImg,</span><br><span class="line">           create_time createTime</span><br><span class="line">    from sys_user</span><br><span class="line">    where 1=1</span><br><span class="line">    <span class="tag"><<span class="name">choose</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">when</span> <span class="attr">test</span>=<span class="string">"id != null"</span>></span></span><br><span class="line">            and id = #{id}</span><br><span class="line">        <span class="tag"></<span class="name">when</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">when</span> <span class="attr">test</span>=<span class="string">"userName != null and userName != ''"</span>></span></span><br><span class="line">            and user_name = #{userName}</span><br><span class="line">        <span class="tag"></<span class="name">when</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">otherwise</span>></span></span><br><span class="line">            and 1=2</span><br><span class="line">        <span class="tag"></<span class="name">otherwise</span>></span></span><br><span class="line">    <span class="tag"></<span class="name">choose</span>></span></span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line">添加otherwise防止1=1把所有的数据查询出来</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByIdList"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">    select id,</span><br><span class="line">           user_name userName,</span><br><span class="line">           user_password userPassword,</span><br><span class="line">           user_email userEmail,</span><br><span class="line">           user_info userInfo,</span><br><span class="line">           head_img headImg,</span><br><span class="line">           create_time createTime</span><br><span class="line">    from sys_user</span><br><span class="line">    where id in</span><br><span class="line">    <span class="tag"><<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"idList"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">index</span>=<span class="string">"i"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">open</span>=<span class="string">"("</span>></span></span><br><span class="line">        #{id}</span><br><span class="line">    <span class="tag"></<span class="name">foreach</span>></span></span><br><span class="line"><span class="tag"></<span class="name">select</span>></span></span><br><span class="line">index为索引的属性名，在集合数组情况下值为当前索引值，当迭代循环的对象是Map类型时，这个值为Map的key</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertList"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>></span></span><br><span class="line">    insert into</span><br><span class="line">        sys_user(user_name, user_password, user_email, user_info, head_img, create_time)</span><br><span class="line">    VALUES</span><br><span class="line">    <span class="tag"><<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"userList"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">index</span>=<span class="string">"i"</span> <span class="attr">item</span>=<span class="string">"user"</span>></span></span><br><span class="line">        (#{user.userName},#{user.userPassword},#{user.userEmail},#{user.userInfo},#{user.headImg},#{user.createTime})</span><br><span class="line">    <span class="tag"></<span class="name">foreach</span>></span></span><br><span class="line"><span class="tag"></<span class="name">insert</span>></span></span><br><span class="line">使用item指定的属性.属性如user.userName来插入数据,并且批量返回id值</span><br><span class="line"></span><br><span class="line"><span class="tag"><<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateByMap"</span>></span></span><br><span class="line">    update sys_user</span><br><span class="line">    set</span><br><span class="line">    <span class="tag"><<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"_parameter"</span> <span class="attr">item</span>=<span class="string">"val"</span> <span class="attr">index</span>=<span class="string">"key"</span> <span class="attr">separator</span>=<span class="string">","</span>></span></span><br><span class="line">        ${key} = #{val}</span><br><span class="line">    <span class="tag"></<span class="name">foreach</span>></span></span><br><span class="line">    where id = #{id}</span><br><span class="line"><span class="tag"></<span class="name">update</span>></span></span><br><span class="line">key作为列名，val是值,没有使用@Param注解指定参数名，就使用默认值_parameter作为该参数的key</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById"</span> <span class="attr">resultType</span>=<span class="string">"com.huang.cloud.userservice.domain.SysUser"</span>></span></span><br><span class="line">        select</span><br><span class="line">            u.id,</span><br><span class="line">            u.user_name userName,</span><br><span class="line">            u.user_password userPassword,</span><br><span class="line">            u.user_email userEmail,</span><br><span class="line">            u.user_info userInfo,</span><br><span class="line">            u.head_img headImg,</span><br><span class="line">            u.create_time createTime,</span><br><span class="line">            r.id 'role.id',</span><br><span class="line">            r.role_name 'role.roleName',</span><br><span class="line">            r.enabled 'role.enabled',</span><br><span class="line">            r.create_by 'role.createBy',</span><br><span class="line">            r.create_time 'role.createTime'</span><br><span class="line">        from sys_user u</span><br><span class="line">        inner join sys_user_role ur on u.id = ur.user_id</span><br><span class="line">        inner join sys_role r on ur.role_id = r.id</span><br><span class="line">        where u.id = #{id}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line">    使用role.前缀将role属性映射到SysUser的role属性上</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleById2"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>></span></span><br><span class="line">        select</span><br><span class="line">            u.id,</span><br><span class="line">            u.user_name,</span><br><span class="line">            u.user_password,</span><br><span class="line">            u.user_email,</span><br><span class="line">            u.user_info,</span><br><span class="line">            u.head_img,</span><br><span class="line">            u.create_time,</span><br><span class="line">            r.id role_id,</span><br><span class="line">            r.role_name,</span><br><span class="line">            r.enabled enabled,</span><br><span class="line">            r.create_by,</span><br><span class="line">            r.create_time role_create_time</span><br><span class="line">        from sys_user u</span><br><span class="line">                 inner join sys_user_role ur on u.id = ur.user_id</span><br><span class="line">                 inner join sys_role r on ur.role_id = r.id</span><br><span class="line">        where u.id = #{id}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserAndRoleByIdSelect"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMapSelect"</span>></span></span><br><span class="line">        select</span><br><span class="line">            u.id,</span><br><span class="line">            u.user_name,</span><br><span class="line">            u.user_password,</span><br><span class="line">            u.user_email,</span><br><span class="line">            u.user_info,</span><br><span class="line">            u.head_img,</span><br><span class="line">            u.create_time,</span><br><span class="line">            ur.role_id</span><br><span class="line">        from sys_user u</span><br><span class="line">        inner join sys_user_role ur on u.id = ur.user_id</span><br><span class="line">        where u.id = #{id}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRoles"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap"</span>></span></span><br><span class="line">        select</span><br><span class="line">            u.id,</span><br><span class="line">            u.user_name,</span><br><span class="line">            u.user_password,</span><br><span class="line">            u.user_email,</span><br><span class="line">            u.user_info,</span><br><span class="line">            u.head_img,</span><br><span class="line">            u.create_time,</span><br><span class="line">            r.id role_id,</span><br><span class="line">            r.role_name role_role_name,</span><br><span class="line">            r.enabled role_enabled,</span><br><span class="line">            r.create_by role_create_by,</span><br><span class="line">            r.create_time role_create_time</span><br><span class="line">        from sys_user u</span><br><span class="line">        inner join sys_user_role ur on u.id = ur.user_id</span><br><span class="line">        inner join sys_role r on ur.role_id = r.id</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRoles"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMap"</span>></span></span><br><span class="line">        select</span><br><span class="line">            u.id,</span><br><span class="line">            u.user_name,</span><br><span class="line">            u.user_password,</span><br><span class="line">            u.user_email,</span><br><span class="line">            u.user_info,</span><br><span class="line">            u.head_img,</span><br><span class="line">            u.create_time,</span><br><span class="line">            r.id role_id,</span><br><span class="line">            r.role_name role_role_name,</span><br><span class="line">            r.enabled role_enabled,</span><br><span class="line">            r.create_by role_create_by,</span><br><span class="line">            r.create_time role_create_time,</span><br><span class="line">            p.privilege_name role_privilege_privilege_name,</span><br><span class="line">            p.privilege_url role_privilege_privilege_url</span><br><span class="line">        from sys_user u</span><br><span class="line">            inner join sys_user_role ur on u.id = ur.user_id</span><br><span class="line">            inner join sys_role r on ur.role_id = r.id</span><br><span class="line">            inner join sys_role_privilege rp on r.id = rp.role_id</span><br><span class="line">            inner join sys_privilege p on rp.privilege_id = p.id</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line">    注意双层嵌套下，不但要加privilege前缀还有role前缀</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectAllUserAndRolesSelect"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleListMapSelect"</span>></span></span><br><span class="line">        select</span><br><span class="line">            u.id,</span><br><span class="line">            u.user_name,</span><br><span class="line">            u.user_password,</span><br><span class="line">            u.user_email,</span><br><span class="line">            u.user_info,</span><br><span class="line">            u.head_img,</span><br><span class="line">            u.create_time</span><br><span class="line">        from sys_user u</span><br><span class="line">        where u.id = #{id}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line"><span class="tag"></<span class="name">mapper</span>></span></span><br></pre></td></tr></tbody></table></figure>



<p>RoleMapper</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleMapper</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function">SysRole <span class="title">selectRoleById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateById</span><span class="params">(SysRole role)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysRole> <span class="title">selectRoleByUserId</span><span class="params">(Long userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysRole> <span class="title">selectRoleByUserIdChoose</span><span class="params">(Long userId)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><?xml version="1.0" encoding="utf-8" ?></span></span><br><span class="line"><span class="meta"><!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> ></span></span><br><span class="line"><span class="tag"><<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.huang.cloud.userservice.mapper.RoleMapper"</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span> /></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"enabled"</span> <span class="attr">column</span>=<span class="string">"enabled"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createBy"</span> <span class="attr">column</span>=<span class="string">"create_by"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">column</span>=<span class="string">"create_time"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"rolePrivilegesMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span> <span class="attr">extends</span>=<span class="string">"roleMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"privileges"</span> <span class="attr">columnPrefix</span>=<span class="string">"privilege_"</span> <span class="attr">resultMap</span>=<span class="string">"com.huang.cloud.userservice.mapper.PrivilegeMapper.privilegeMap"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"rolePrivilegeListMapSelect"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span> <span class="attr">extends</span>=<span class="string">"roleMap"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"privileges"</span> <span class="attr">fetchType</span>=<span class="string">"lazy"</span> <span class="attr">column</span>=<span class="string">"{roleId=id}"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">"com.huang.cloud.userservice.mapper.PrivilegeMapper.selectPrivilegeByRoleId"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"rolePrivilegeListMapChoose"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysRole"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">"int"</span> <span class="attr">column</span>=<span class="string">"enabled"</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">case</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">resultMap</span>=<span class="string">"rolePrivilegeListMapSelect"</span>/></span></span><br><span class="line">            <span class="tag"><<span class="name">case</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>/></span></span><br><span class="line">        <span class="tag"></<span class="name">discriminator</span>></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line">    discriminator标签相当于switch，在不同的case下返回不同的map,column设置要进行鉴别比较值的列，javaType用于指定列的类型</span><br><span class="line">    enabled为1时状态可用，使用一对多嵌套查询映射，因此可以获取到该角色下详细的权限信息，为0时不可用，只能获取角色的基本信息</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRoleById"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>></span></span><br><span class="line">        select * from sys_role where id = #{id}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateById"</span>></span></span><br><span class="line">        update sys_role</span><br><span class="line">        <span class="tag"><<span class="name">set</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"roleName != null and roleName !=''"</span>></span></span><br><span class="line">                role_name = #{roleName},</span><br><span class="line">            <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"enabled != null"</span>></span></span><br><span class="line">                enabled = #{enabled},</span><br><span class="line">            <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"createBy != null"</span>></span></span><br><span class="line">                create_by = #{createBy},</span><br><span class="line">            <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">            <span class="tag"><<span class="name">if</span> <span class="attr">test</span>=<span class="string">"createTime != null"</span>></span></span><br><span class="line">                create_time = #{createTime},</span><br><span class="line">            <span class="tag"></<span class="name">if</span>></span></span><br><span class="line">            id = #{id},</span><br><span class="line">        <span class="tag"></<span class="name">set</span>></span></span><br><span class="line">        where id = #{id}</span><br><span class="line">    <span class="tag"></<span class="name">update</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRoleByUserId"</span> <span class="attr">resultMap</span>=<span class="string">"rolePrivilegeListMapSelect"</span>></span></span><br><span class="line">        select</span><br><span class="line">            r.id,</span><br><span class="line">            r.role_name,</span><br><span class="line">            r.enabled,</span><br><span class="line">            r.create_by,</span><br><span class="line">            r.create_time</span><br><span class="line">        from sys_role r</span><br><span class="line">        inner join sys_user_role ur on ur.role_id = r.id</span><br><span class="line">        where ur.user_id = #{userId}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line">    roleId是select指定方法selectPrivilegeByRoleId查询中的参数,id是当前查询selectRoleByUserId中查询出的角色id</span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectRoleByUserIdChoose"</span> <span class="attr">resultMap</span>=<span class="string">"rolePrivilegeListMapChoose"</span>></span></span><br><span class="line">        select</span><br><span class="line">            r.id,</span><br><span class="line">            r.role_name,</span><br><span class="line">            r.enabled,</span><br><span class="line">            r.create_by,</span><br><span class="line">            r.create_time</span><br><span class="line">        from sys_role r</span><br><span class="line">            inner join sys_user_role ur on ur.role_id = r.id</span><br><span class="line">        where ur.user_id = #{userId}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line"><span class="tag"></<span class="name">mapper</span>></span></span><br></pre></td></tr></tbody></table></figure>

<p>PrivilegeMapper</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PrivilegeMapper</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function">List<SysPrivilege> <span class="title">selectPrivilegeByRoleId</span><span class="params">(Long roleId)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><?xml version="1.0" encoding="utf-8" ?></span></span><br><span class="line"><span class="meta"><!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> ></span></span><br><span class="line"><span class="tag"><<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.huang.cloud.userservice.mapper.PrivilegeMapper"</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"privilegeMap"</span> <span class="attr">type</span>=<span class="string">"com.huang.cloud.userservice.domain.SysPrivilege"</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">column</span>=<span class="string">"privilege_name"</span> <span class="attr">property</span>=<span class="string">"privilegeName"</span>/></span></span><br><span class="line">        <span class="tag"><<span class="name">result</span> <span class="attr">column</span>=<span class="string">"privilege_url"</span> <span class="attr">property</span>=<span class="string">"privilegeUrl"</span>/></span></span><br><span class="line">    <span class="tag"></<span class="name">resultMap</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPrivilegeByRoleId"</span> <span class="attr">resultMap</span>=<span class="string">"privilegeMap"</span>></span></span><br><span class="line">        select</span><br><span class="line">            p.*</span><br><span class="line">        from sys_privilege p</span><br><span class="line">            inner join sys_role_privilege rp on p.id = rp.privilege_id</span><br><span class="line">            inner join sys_role r on r.id = rp.role_id</span><br><span class="line">        where role_id = #{roleId}</span><br><span class="line">    <span class="tag"></<span class="name">select</span>></span></span><br><span class="line"><span class="tag"></<span class="name">mapper</span>></span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huang.cloud.userservice.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.huang.cloud.userservice.domain.SysPrivilege;</span><br><span class="line"><span class="keyword">import</span> com.huang.cloud.userservice.domain.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.huang.cloud.userservice.domain.SysUser;</span><br><span class="line"><span class="keyword">import</span> org.assertj.core.api.Assert;</span><br><span class="line"><span class="keyword">import</span> org.assertj.core.api.Assertions;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleMapper roleMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(UserMapperTest<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectById</span><span class="params">()</span> </span>{</span><br><span class="line">        LOGGER.info(<span class="string">"查询成功: "</span>+userMapper.selectById(<span class="number">1L</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectAll</span><span class="params">()</span> </span>{</span><br><span class="line">        LOGGER.info(<span class="string">"查询成功: "</span>+userMapper.selectAll());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectRolesByUserId</span><span class="params">()</span> </span>{</span><br><span class="line">        LOGGER.info(<span class="string">"查询成功: "</span>+userMapper.selectRolesByUserId(<span class="number">1L</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = <span class="keyword">new</span> SysUser();</span><br><span class="line">        user.setUserName(<span class="string">"test1"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"123456"</span>);</span><br><span class="line">        user.setUserEmail(<span class="string">"test@mybatis.tk"</span>);</span><br><span class="line">        user.setUserInfo(<span class="string">"test info"</span>);</span><br><span class="line">        user.setHeadImg(<span class="keyword">new</span> <span class="keyword">byte</span>[]{<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>});</span><br><span class="line">        user.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">int</span> result = userMapper.insert(user);<span class="comment">//受影响的行数</span></span><br><span class="line">        <span class="keyword">assert</span> result==<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">assert</span> user.getId()==<span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert2</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = <span class="keyword">new</span> SysUser();</span><br><span class="line">        user.setUserName(<span class="string">"test1"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"123456"</span>);</span><br><span class="line">       <span class="comment">// user.setUserEmail("test@mybatis.tk");</span></span><br><span class="line">        user.setUserInfo(<span class="string">"test info"</span>);</span><br><span class="line">        user.setHeadImg(<span class="keyword">new</span> <span class="keyword">byte</span>[]{<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>});</span><br><span class="line">        user.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        userMapper.insert2(user);</span><br><span class="line">        LOGGER.info(<span class="string">"插入成功,userId: "</span>+user.getId());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert3</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = <span class="keyword">new</span> SysUser();</span><br><span class="line">        user.setUserName(<span class="string">"test1"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"123456"</span>);</span><br><span class="line">        user.setUserEmail(<span class="string">"test@mybatis.tk"</span>);</span><br><span class="line">        user.setUserInfo(<span class="string">"test info"</span>);</span><br><span class="line">        user.setHeadImg(<span class="keyword">new</span> <span class="keyword">byte</span>[]{<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>});</span><br><span class="line">        user.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        userMapper.insert3(user);</span><br><span class="line">        LOGGER.info(<span class="string">"插入成功,userId: "</span>+user.getId());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateById</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">        user.setUserName(<span class="string">"admin_test"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"66666"</span>);</span><br><span class="line">        user.setUserEmail(<span class="string">"test@mybatis.tk"</span>);</span><br><span class="line">        user.setUserInfo(<span class="string">"test info"</span>);</span><br><span class="line">        user.setHeadImg(<span class="keyword">new</span> <span class="keyword">byte</span>[]{<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>});</span><br><span class="line">        user.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">        LOGGER.info(<span class="string">"更新成功,userId: {},userName: {}"</span>,user.getId(),user.getUserName());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">()</span> </span>{</span><br><span class="line">        userMapper.deleteById(<span class="number">1004L</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectRolesByUserIdAndRoleEnabled</span><span class="params">()</span> </span>{</span><br><span class="line">        List<SysRole> roles = userMapper.selectRolesByUserIdAndRoleEnabled(<span class="number">1L</span>,<span class="number">1</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"roles: "</span>+roles);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectByUser</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = <span class="keyword">new</span> SysUser();</span><br><span class="line">        user.setUserName(<span class="string">"test"</span>);</span><br><span class="line">        user.setUserEmail(<span class="string">"test@test.tk"</span>);</span><br><span class="line">        LOGGER.info(userMapper.selectByUser(user).toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateByIdSelective</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = <span class="keyword">new</span> SysUser();</span><br><span class="line">        user.setId(<span class="number">1L</span>);</span><br><span class="line">        user.setUserName(<span class="string">"admin"</span>);</span><br><span class="line">        user.setUserEmail(<span class="string">"test@admin.tk"</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"更新成功:"</span>+userMapper.updateByIdSelective(user));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectByIdOrUserName</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = <span class="keyword">new</span> SysUser();</span><br><span class="line">        <span class="comment">//user.setId(1L);</span></span><br><span class="line">        user.setUserName(<span class="string">"admin"</span>);</span><br><span class="line">        LOGGER.info(userMapper.selectByIdOrUserName(user).toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectByIdList</span><span class="params">()</span> </span>{</span><br><span class="line">        List<Long> ids = <span class="keyword">new</span> ArrayList<>();</span><br><span class="line">        ids.add(<span class="number">1L</span>);</span><br><span class="line">        ids.add(<span class="number">1003L</span>);</span><br><span class="line">        ids.add(<span class="number">1004L</span>);</span><br><span class="line">        LOGGER.info(userMapper.selectByIdList(ids).toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertList</span><span class="params">()</span> </span>{</span><br><span class="line">        List<SysUser> userList = <span class="keyword">new</span> ArrayList<SysUser>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">2</span>; i++) {</span><br><span class="line">            SysUser user = <span class="keyword">new</span> SysUser();</span><br><span class="line">            user.setUserName(<span class="string">"test"</span>+i);</span><br><span class="line">            user.setUserPassword(<span class="string">"123456"</span>);</span><br><span class="line">            user.setUserEmail(<span class="string">"test@mybatis.tk"</span>);</span><br><span class="line">            userList.add(user);</span><br><span class="line">        }</span><br><span class="line">        LOGGER.info(<span class="string">"插入结果: "</span>+userMapper.insertList(userList));</span><br><span class="line">        <span class="keyword">for</span>(SysUser user : userList)</span><br><span class="line">            LOGGER.info(<span class="string">"id:"</span>+user.getId());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateByMap</span><span class="params">()</span> </span>{</span><br><span class="line">        Map<String,Object> map = <span class="keyword">new</span> HashMap<>();</span><br><span class="line">        map.put(<span class="string">"id"</span>,<span class="number">1L</span>);</span><br><span class="line">        map.put(<span class="string">"user_email"</span>,<span class="string">"test@mybatis.tk"</span>);</span><br><span class="line">        map.put(<span class="string">"user_password"</span>,<span class="string">"12345678"</span>);</span><br><span class="line">        userMapper.updateByMap(map);</span><br><span class="line">        SysUser user = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"user: "</span>+user);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectUserAndRoleById</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = userMapper.selectUserAndRoleById(<span class="number">1001L</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"user: "</span>+user);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectUserAndRoleById2</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = userMapper.selectUserAndRoleById2(<span class="number">1001L</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"user: "</span>+user);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectUserAndRoleByIdSelect</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = userMapper.selectUserAndRoleByIdSelect(<span class="number">1001L</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"user: "</span>+user);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectAllUserAndRoles</span><span class="params">()</span> </span>{</span><br><span class="line">        List<SysUser> users = userMapper.selectAllUserAndRoles();</span><br><span class="line">        LOGGER.info(<span class="string">"用户数: "</span>+users.size());</span><br><span class="line">        <span class="keyword">for</span>(SysUser user : users){</span><br><span class="line">            LOGGER.info(<span class="string">"用户名： "</span>+user.getUserName());</span><br><span class="line">            <span class="keyword">for</span>(SysRole role : user.getRoleList()) {</span><br><span class="line">                LOGGER.info(<span class="string">"角色名： "</span> + role.getRoleName());</span><br><span class="line">                <span class="keyword">for</span>(SysPrivilege privilege : role.getPrivileges())</span><br><span class="line">                    LOGGER.info(<span class="string">"权限名： "</span>+privilege.getPrivilegeName());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectAllUserAndRolesSelect</span><span class="params">()</span> </span>{</span><br><span class="line">        SysUser user = userMapper.selectAllUserAndRolesSelect(<span class="number">1L</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"用户名： "</span>+user.getUserName());</span><br><span class="line">        <span class="keyword">for</span>(SysRole role : user.getRoleList()) {</span><br><span class="line">            LOGGER.info(<span class="string">"角色名： "</span> + role.getRoleName());</span><br><span class="line">            <span class="keyword">for</span>(SysPrivilege privilege : role.getPrivileges())</span><br><span class="line">                LOGGER.info(<span class="string">"权限名： "</span>+privilege.getPrivilegeName());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//默认一次事物使用同一个sqlsession,同一个一级缓存，所以只会进行一次查询</span></span><br><span class="line">    <span class="comment">//关闭事务就不是一个sqlsession了,任何的insert、update、delete操作都会清空一级缓存</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testFirstCache</span><span class="params">()</span></span>{</span><br><span class="line">        SysUser user1 = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">        user1.setUserName(<span class="string">"admin_user"</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"user1: "</span>+user1);</span><br><span class="line">        userMapper.deleteById(<span class="number">1006L</span>);</span><br><span class="line">        SysUser user2 = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"user2: "</span>+user2);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testSecondCache</span><span class="params">()</span></span>{</span><br><span class="line">        SysUser user1 = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">        SysUser user2 = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huang.cloud.userservice.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.huang.cloud.userservice.domain.SysRole;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.ws.soap.Addressing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoleMapperTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(RoleMapperTest<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleMapper roleMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">selectRoleByUserIdChoose</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//更新enabled</span></span><br><span class="line">        SysRole role = roleMapper.selectRoleById(<span class="number">2L</span>);</span><br><span class="line">        role.setEnabled(<span class="number">0</span>);</span><br><span class="line">        roleMapper.updateById(role);</span><br><span class="line">        <span class="comment">//获取用户1的角色</span></span><br><span class="line">        List<SysRole> roles = roleMapper.selectRoleByUserIdChoose(<span class="number">1L</span>);</span><br><span class="line">        <span class="keyword">for</span>(SysRole r : roles){</span><br><span class="line">            LOGGER.info(<span class="string">"角色名: "</span>+r.getRoleName());</span><br><span class="line">            LOGGER.info(<span class="string">"enabled: "</span>+r.getEnabled());</span><br><span class="line">            LOGGER.info(<span class="string">"权限: "</span>+r.getPrivileges());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Huang Qingshan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://alifebug.github.io/2021/02/16/Mybatis%E7%A4%BA%E4%BE%8B/">http://alifebug.github.io/2021/02/16/Mybatis%E7%A4%BA%E4%BE%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://ALifeBug.github.io">ALifeBug</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mybatis/">Mybatis    </a></div><div class="post_share"><div class="social-share" data-image="https://s2.ax1x.com/2019/11/04/Kv8O6U.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/wechat.png"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/alipay.png"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2021/02/17/SpringCloud%E5%85%A8%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0/"><img class="prev_cover lozad" data-src="https://s2.ax1x.com/2019/11/04/Kv8O6U.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>SpringCloud全系列笔记</span></div></a></div><div class="next-post pull-right"><a href="/2020/12/20/Leetcode-SQL/"><img class="next_cover lozad" data-src="https://s2.ax1x.com/2019/11/04/Kv8O6U.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Leetcode-SQL</span></div></a></div></nav></div></div><footer><div id="footer"><div class="copyright">&copy;2018 - 2021 By Huang Qingshan</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">简</a><i class="nightshift fa fa-moon-o" id="nightshift" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/nightshift.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script>const observer = lozad(); // lazy loads elements with default selector as '.lozad'
observer.observe();
</script></body></html>